<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>首頁</title>

    <link rel="icon" href="/assets/images/favicon.ico">

    <script src="/assets/js/jquery-1.11.3.min.js"></script>

    <!--input data-include property in any tag when window.onload-->
    <script src="/navbar/js/csi.min.js"></script>

    <!-- navbar-->
    <script src="/navbar/js/navbar-init.js"></script>

    <!-- chatroom -->
    <script src="/chat/js/sockjs.min.js"></script>
    <script src="/chat/js/stomp.min.js"></script>
    <script src="/chat/js/chatroom-init.js"></script>

    <!-- Main Quill library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="/forum/quill/quill.js"></script>
    <script src="/forum/quill/quill.min.js"></script>
    <!-- plyr -->
    <link rel="stylesheet" href="https://cdn.plyr.io/3.5.3/plyr.css" />
    <script src="https://cdn.plyr.io/3.5.3/plyr.polyfilled.js"></script>

    <!-- my -->
    <script src="/forum/js/topic/yyyymmddhhiiDate.js"></script>
    <script src="/forum/js/topic/createTopicView.js"></script>
    <script src="/forum/js/topic/searchTopicAutocomplete.js"></script>
    <link rel="stylesheet" href="/assets/css/font-icons/font-awesome/css/font-awesome.min.css">

    <style>
        * {
            box-sizing: border-box;
        }

        /* body {
            font: 16px Arial;
        } */

        .main-content * {
            margin: 0px;
            padding: 0px;
        }

        .myTopicList {
            max-width: 1036px;
            margin: auto;
        }

        .mySearch {
            /* position: fixed;
            z-index: 55000; */
            /* border-bottom: 1px solid #ebebeb; */
            border-bottom: 1px solid #CCCCCC;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        .mySubTopicBlock {
            border-bottom: 1px solid #CCCCCC;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        /*the container must be positioned relative:*/

        .autocomplete {
            position: relative;
            display: inline-block;
            width: 600px;
            margin-left: 190px;
        }

        input {
            border: 1px solid transparent;
            background-color: #f1f1f1;
            font-size: 16px;
        }

        input[type=text] {
            background-color: #f1f1f1;
            width: 100%;
            padding: 8px;
        }

        input[type=submit] {
            background-color: DodgerBlue;
            color: #fff;
            cursor: pointer;
            padding: 8px;
        }

        .autocomplete-items {
            position: absolute;
            border: 1px solid #d4d4d4;
            border-bottom: none;
            border-top: none;
            z-index: 99;
            /*position the autocomplete items to be the same width as the container:*/
            top: 100%;
            left: 0;
            right: 0;
        }

        .autocomplete-items div {
            padding: 8px;
            cursor: pointer;
            background-color: #fff;
            border-bottom: 1px solid #d4d4d4;
        }

        /*when hovering an item:*/

        .autocomplete-items div:hover {
            background-color: #e9e9e9;
        }

        /*when navigating through the items using the arrow keys:*/

        .autocomplete-active {
            background-color: DodgerBlue !important;
            color: #ffffff;
        }
    </style>

    <script>
        let startPosition = 1;
        let maxResult = 8;
        let orderType = "orderByTime"; //orderByTime orderByLike
        $(document).ready(function () {
            autocomplete(document.getElementById("myInput"));
            let searchInput = getUrlParameters().q;
            if (searchInput) {
                $("#requestTopicBlock").hide();
                $("#shareTopicBlock").hide();
                getSearchResults(startPosition, maxResult, "requestTopic", orderType, searchInput);
                getTopicsNum("requestTopic", searchInput);
                getSearchResults(startPosition, maxResult, "shareTopic", orderType, searchInput);
                getTopicsNum("shareTopic", searchInput);
            } else {
                $("#searchTopicBlock").hide();
                getTopicList(startPosition, maxResult, "requestTopic", orderType);
                getTopicsNum("requestTopic", "");
                getTopicList(startPosition, maxResult, "shareTopic", orderType);
                getTopicsNum("shareTopic", "");
            }
        })

        function getUrlParameters() {
            let parameters = [];
            let hash;
            let hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
            for (let i = 0; i < hashes.length; i++) {
                hash = hashes[i].split('=');
                parameters.push(hash[0]);
                parameters[hash[0]] = hash[1];
            }
            return parameters;
        }

        function getSearchResults(begin, end, topicType, orderType, searchInput) {
            $.ajax({
                url: `http://localhost:8080/articleTopics?begin=${begin}&end=${end}&topicType=${topicType}&orderType=${orderType}&likeTopicHeader=${searchInput}`,
                type: "GET",
                success: function (dataTopicList) {
                    resultDivId = topicType + "Search";
                    if (dataTopicList.length > 0) {
                        createTopicView(dataTopicList, resultDivId);
                        $(".plyr video").height("150px");
                        $(".plyr__controls").hide();
                        $(".plyr__control--overlaid").hide();
                    } else {
                        $(`#${resultDivId}`).text("查無資料");
                    }
                }
            });
        }

        function getTopicList(begin, end, topicType, orderType) {
            $.ajax({
                url: `http://localhost:8080/articleTopics?begin=${begin}&end=${end}&topicType=${topicType}&orderType=${orderType}`,
                type: "GET",
                success: function (dataTopicList) {
                    createTopicView(dataTopicList, topicType);
                    $(".plyr video").height("150px");
                    $(".plyr__controls").hide();
                    $(".plyr__control--overlaid").hide();
                }
            });
        }

        function getTopicsNum(topicType, likeTopicHeader) {
            $.ajax({
                url: `http://localhost:8080/countTopics?topicType=${topicType}&likeTopicHeader=${likeTopicHeader}`,
                type: "GET",
                success: function (data) {
                    createPagination(data, topicType, likeTopicHeader);
                }
            });
        }

        function createPagination(totalNum, topicType, likeTopicHeader) {
            let paginationDivId;
            if (likeTopicHeader == "") {
                paginationDivId = topicType + "Pagi";
            } else {
                paginationDivId = topicType + "SearchPagi";
            }
            console.log(totalNum + " " + paginationDivId);
            console.log($(`#${paginationDivId}`).text());
        }

    </script>
</head>

<body class="page-body" data-url="http://neon.dev">
    <!-- include navbar when window.onload-->
    <div data-include="/navbar/navbarWhite.html"></div>

    <div class="page-container">
        <div class="main-content">

            <div class="myTopicList">
                <div class="col-md-12 mySearch">
                    <!--Make sure the form has the autocomplete function switched off:-->
                    <form id="searchForm" autocomplete="off" action="/index.html">
                        <div class="autocomplete">
                            <input id="myInput" type="text" name="q" placeholder="請輸入關鍵字">
                        </div>
                        <input type="submit" value="搜尋">
                    </form>
                </div>
                <div class="col-md-12 mySubTopicBlock">
                    <form>
                        排序依據：
                        <input type="radio" name="orderTypeName" value="orderByTime" checked>時間
                        <input type="radio" name="orderTypeName" value="orderByLike">熱度
                    </form>
                </div>
                <div class="col-md-12 mySubTopicBlock" id="requestTopicBlock">
                    <div class="col-md-12">
                        <h1>需求</h1>
                    </div>
                    <div class="col-md-12" id="requestTopic"></div>
                    <div class="col-md-12" id="requestTopicPagi">
                        <ul class="pagination pagination-lg">
                            <li>
                                <a href="#">
                                    <i class="entypo-left-open-mini"></i>
                                </a>
                            </li>
                            <li>
                                <a href="#">1</a>
                            </li>
                            <li class="active">
                                <a href="#">2</a>
                            </li>
                            <li>
                                <a href="#">3</a>
                            </li>
                            <li>
                                <a href="#">4</a>
                            </li>
                            <li>
                                <a href="#">5</a>
                            </li>
                            <li>
                                <a href="#">6</a>
                            </li>
                            <li>
                                <a href="#">
                                    <i class="entypo-right-open-mini"></i>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-12 mySubTopicBlock" id="shareTopicBlock">
                    <div class="col-md-12">
                        <h1>提供</h1>
                    </div>
                    <div class="col-md-12" id="shareTopic"></div>
                    <div class="col-md-12" id="shareTopicPagi">2</div>
                </div>
                <div class="col-md-12 mySubTopicBlock" id="searchTopicBlock">
                    <div class="col-md-12">
                        <h1>搜尋結果</h1>
                    </div>
                    <div class="col-md-12">
                        <h1>需求</h1>
                    </div>
                    <div class="col-md-12" id="requestTopicSearch"></div>
                    <div class="col-md-12" id="requestTopicSearchPagi">3</div>
                    <div class="col-md-12">
                        <h1>提供</h1>
                    </div>
                    <div class="col-md-12" id="shareTopicSearch"></div>
                    <div class="col-md-12" id="shareTopicSearchPagi">4</div>
                </div>

                <!-- <div class="col-md-3" style="padding: 8px">
                    <div class="col-md-12" style="height: 150px; margin: 1px;  ">
                        <img height="100%" width="100%" src="navbar/images/1558837130883Indian Parrot Greet Indian Parrot.mp4.jpg">
                    </div>
                    <a href="index.html" id="linkToContent">
                        <div class="col-md-12" id="topicHeaderDiv" style="margin: 1px; text-decoration: underline; font-weight: bolder;">我是好一個很長標題嗎......</div>
                        <div class="col-md-12" style="font-size: 14px; margin: 1px;  ">主要目標是發大財主要目標是發大 ......</div>
                    </a>
                    <div class="col-md-12" id="memberNameDiv" style="font-size: 14px; margin: 1px; color: #0066CC;">
                        <img src="/navbar/images/wowlogo.png" alt="" class="img-circle" width="34" />&nbsp;John Henderson</div>
                    <div class="col-md-2" style="font-size: 14px; margin: 1px; width: 45px;">
                        <i class="fa fa-thumbs-o-up"></i>&nbsp;1</div>
                    <div class="col-md-2" style="font-size: 14px; margin: 1px; width: 45px;">
                        <i class="fa fa-commenting-o"></i>&nbsp;322</div>
                    <div class="col-md-2" style="font-size: 14px; margin: 1px; width: 45px;">
                        <i class="fa fa-eye"></i>&nbsp;225</div>
                    <div class="col-md-6" style="float: right; text-align: right; font-size: 14px; margin: 1px; width: 95px;">
                        <i class="fa fa-video-camera"></i>&nbsp;2019-05-06</div>
                </div> -->

            </div>


        </div>

    </div>


    <!-- JavaScripts initializations and stuff -->
    <!-- YW: this is important for navbar -->
    <script src="/assets/js/neon-custom.js"></script>

    <!-- Bottom scripts (common) -->
    <script src="/assets/js/gsap/TweenMax.min.js"></script>
    <script src="/assets/js/jquery-ui/js/jquery-ui-1.10.3.minimal.min.js"></script>
    <script src="/assets/js/bootstrap.js"></script>
    <script src="/assets/js/joinable.js"></script>
    <script src="/assets/js/resizeable.js"></script>
    <script src="/assets/js/neon-api.js"></script>

    <!-- Imported scripts on this page -->
    <!-- <script src="/assets/js/neon-chat.js"></script> -->

    <!-- Demo Settings -->
    <!-- <script src="/assets/js/neon-demo.js"></script> -->

</body>

</html>